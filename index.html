<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Test System - Sir Faris</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); min-height: 100vh; color: #fff; }
        .screen { display: none; }
        .screen.active { display: block; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box, .result-box { background: #2d2d2d; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); width: 100%; max-width: 500px; border: 1px solid #444; }
        h1 { color: #fff; text-align: center; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        h2 { color: #fff; margin-bottom: 20px; text-align: center; }
        input, select { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #444; border-radius: 8px; font-size: 16px; background: #1a1a1a; color: #fff; }
        input:focus, select:focus { outline: none; border-color: #4CAF50; }
        select option { background: #1a1a1a; color: #fff; }
        button { width: 100%; padding: 15px; margin: 10px 0; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .error { color: #ff6b6b; margin-top: 10px; text-align: center; }
        .test-header { background: #2d2d2d; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.5); flex-wrap: wrap; gap: 10px; border-bottom: 2px solid #4CAF50; }
        .timer { font-size: 24px; font-weight: bold; color: #ff6b6b; padding: 10px 20px; background: #1a1a1a; border-radius: 8px; border: 2px solid #ff6b6b; }
        .month-badge { background: #4CAF50; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .trade-badge { background: #2196F3; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; }
        .test-container { max-width: 900px; margin: 30px auto; background: #2d2d2d; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid #444; }
        .progress-bar { width: 100%; height: 8px; background: #1a1a1a; border-radius: 10px; margin-bottom: 30px; border: 1px solid #444; }
        .progress { height: 100%; background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%); transition: width 0.3s; border-radius: 10px; }
        .option { padding: 15px; margin: 10px 0; border: 2px solid #444; border-radius: 8px; cursor: pointer; display: flex; align-items: center; transition: all 0.3s; background: #1a1a1a; }
        .option:hover { border-color: #4CAF50; background: #2d2d2d; }
        .option.selected { border-color: #4CAF50; background: #4CAF50; color: white; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; }
        .navigation button { width: auto; padding: 12px 30px; }
        .result-details { margin: 30px 0; padding: 20px; background: #1a1a1a; border-radius: 8px; border: 1px solid #444; }
        .result-details p { margin: 15px 0; font-size: 18px; color: #fff; }
        .result-details span { color: #4CAF50; font-weight: bold; }
        .score-display { font-size: 48px; text-align: center; color: #4CAF50; font-weight: bold; margin: 20px 0; }
        table { width: 100%; background: #2d2d2d; border-collapse: collapse; margin-top: 20px; border-radius: 8px; overflow: hidden; border: 1px solid #444; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; color: #fff; }
        th { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; font-weight: bold; }
        tr:hover { background: #1a1a1a; }
        .month-select { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .month-btn { padding: 20px; background: #1a1a1a; border: 2px solid #444; border-radius: 10px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s; color: #fff; position: relative; }
        .month-btn:hover:not(.locked) { border-color: #4CAF50; background: #2d2d2d; }
        .month-btn.selected { border-color: #4CAF50; background: #4CAF50; color: white; }
        .month-btn.locked { opacity: 0.4; cursor: not-allowed; }
        .month-btn.locked::after { content: 'üîí'; position: absolute; top: 10px; right: 10px; font-size: 20px; }
        .month-btn.completed::after { content: '‚úÖ'; position: absolute; top: 10px; right: 10px; font-size: 20px; }
        .footer { position: fixed; bottom: 10px; right: 20px; color: #888; font-size: 14px; font-style: italic; }
        .question h3 { color: #fff; margin-bottom: 20px; }
        .question p { color: #ddd; }
        #questionCounter { color: #4CAF50; font-weight: bold; }
        .admin-btn { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%) !important; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="loginScreen" class="screen active">
        <div class="container">
            <h1>üìö Monthly Test System</h1>
            <div class="login-box">
                <h2>Student Login</h2>
                <input type="text" id="studentName" placeholder="Enter Your Name">
                <input type="text" id="studentId" placeholder="Enter Your ID Number">
                
                <select id="tradeSelect">
                    <option value="">-- Select Your Trade --</option>
                    <option value="Computerized Accounting">Computerized Accounting</option>
                    <option value="Data Analytics with AI">Data Analytics with AI</option>
                </select>
                
                <h3 style="margin-top: 20px; color: #fff; font-size: 16px;">Select Test Month:</h3>
                <div class="month-select" id="monthSelect"></div>
                
                <button onclick="startTest()">Start Test</button>
                <button onclick="showAdminLogin()" class="admin-btn">Admin Panel</button>
                <div id="loginError" class="error"></div>
            </div>
        </div>
    </div>

    <div id="testScreen" class="screen">
        <div class="test-header">
            <div><span id="displayName"></span> | <span id="displayId"></span></div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <div class="trade-badge" id="tradeBadge">Trade</div>
                <div class="month-badge" id="monthBadge">Month 1</div>
            </div>
            <div class="timer" id="timer">30:00</div>
        </div>
        <div class="test-container">
            <div class="progress-bar"><div class="progress" id="progress"></div></div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <button onclick="previousQuestion()" id="prevBtn">‚Üê Previous</button>
                <span id="questionCounter"></span>
                <button onclick="nextQuestion()" id="nextBtn">Next ‚Üí</button>
            </div>
            <button onclick="endTest()" style="background: #ff6b6b; margin-top: 20px;">End Test</button>
        </div>
    </div>

    <div id="resultScreen" class="screen">
        <div class="container">
            <div class="result-box">
                <h1>üéâ Test Completed!</h1>
                <div class="score-display" id="scoreDisplay">0/10</div>
                <div class="result-details">
                    <p><strong>Name:</strong> <span id="resultName"></span></p>
                    <p><strong>ID:</strong> <span id="resultId"></span></p>
                    <p><strong>Trade:</strong> <span id="resultTrade"></span></p>
                    <p><strong>Month:</strong> <span id="resultMonth"></span></p>
                </div>
                <button onclick="resetTest()">üîÑ Take Another Test</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="screen">
        <div class="container" style="max-width: 1200px;">
            <h1 style="color: white;">üìä Admin Panel - All Results</h1>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button onclick="backToLogin()">‚Üê Back to Login</button>
                <button onclick="exportToCSV()">üì• Export to Excel (CSV)</button>
                <button onclick="clearAllData()" style="background: #ff6b6b;">üóëÔ∏è Clear All Data</button>
            </div>
            <div id="resultsTable" style="background: #2d2d2d; padding: 20px; border-radius: 15px; overflow-x: auto; border: 1px solid #444;"></div>
        </div>
    </div>

    <div class="footer">Prepared by Sir Faris</div>

    <script>
        const questionsByTradeAndMonth = {
            "Computerized Accounting": {
                1: [
                    { question: "What is accounting?", options: ["Recording transactions", "Selling products", "Marketing", "None"], correct: 0 },
                    { question: "What is a debit?", options: ["Increase in asset", "Decrease in asset", "Increase in liability", "None"], correct: 0 },
                    { question: "What is a credit?", options: ["Decrease in asset", "Increase in asset", "Decrease in liability", "None"], correct: 0 },
                    { question: "What is a journal?", options: ["Book of original entry", "Final accounts", "Balance sheet", "None"], correct: 0 },
                    { question: "What is a ledger?", options: ["Book of final entry", "Book of original entry", "Cash book", "None"], correct: 0 },
                    { question: "What is double entry?", options: ["Two entries for each transaction", "One entry", "Three entries", "None"], correct: 0 },
                    { question: "What is trial balance?", options: ["List of all balances", "Final accounts", "Journal", "None"], correct: 0 },
                    { question: "What is balance sheet?", options: ["Statement of financial position", "Income statement", "Cash flow", "None"], correct: 0 },
                    { question: "What is income statement?", options: ["Profit and loss", "Balance sheet", "Cash flow", "None"], correct: 0 },
                    { question: "What is cash flow?", options: ["Movement of cash", "Profit", "Loss", "None"], correct: 0 }
                ],
                2: [
                    { question: "What is QuickBooks?", options: ["Accounting software", "Database", "Programming language", "None"], correct: 0 },
                    { question: "What is Tally?", options: ["Accounting software", "Spreadsheet", "Word processor", "None"], correct: 0 },
                    { question: "What is depreciation?", options: ["Decrease in asset value", "Increase in asset", "Liability", "None"], correct: 0 },
                    { question: "What is GST?", options: ["Goods and Services Tax", "Income tax", "Sales tax", "None"], correct: 0 },
                    { question: "What is invoice?", options: ["Bill for goods/services", "Receipt", "Voucher", "None"], correct: 0 },
                    { question: "What is voucher?", options: ["Document for transaction", "Invoice", "Receipt", "None"], correct: 0 },
                    { question: "What is bank reconciliation?", options: ["Matching bank and book balances", "Closing accounts", "Opening accounts", "None"], correct: 0 },
                    { question: "What is petty cash?", options: ["Small cash expenses", "Large expenses", "Bank balance", "None"], correct: 0 },
                    { question: "What is accounts payable?", options: ["Money owed to suppliers", "Money owed by customers", "Assets", "None"], correct: 0 },
                    { question: "What is accounts receivable?", options: ["Money owed by customers", "Money owed to suppliers", "Liabilities", "None"], correct: 0 }
                ],
                3: [
                    { question: "What is financial statement?", options: ["Summary of financial activities", "Journal", "Ledger", "None"], correct: 0 },
                    { question: "What is audit?", options: ["Examination of accounts", "Recording", "Posting", "None"], correct: 0 },
                    { question: "What is budget?", options: ["Financial plan", "Actual expenses", "Invoice", "None"], correct: 0 },
                    { question: "What is variance?", options: ["Difference between budget and actual", "Budget only", "Actual only", "None"], correct: 0 },
                    { question: "What is cost accounting?", options: ["Recording and analyzing costs", "Financial accounting", "Tax accounting", "None"], correct: 0 },
                    { question: "What is management accounting?", options: ["Internal reporting", "External reporting", "Tax reporting", "None"], correct: 0 },
                    { question: "What is ratio analysis?", options: ["Analyzing financial ratios", "Recording transactions", "Posting", "None"], correct: 0 },
                    { question: "What is working capital?", options: ["Current assets minus current liabilities", "Fixed assets", "Long term debt", "None"], correct: 0 },
                    { question: "What is equity?", options: ["Owner's capital", "Liabilities", "Assets", "None"], correct: 0 },
                    { question: "What is liability?", options: ["Obligations to pay", "Assets", "Equity", "None"], correct: 0 }
                ],
                4: [
                    { question: "What is ERP?", options: ["Enterprise Resource Planning", "Accounting software", "Database", "None"], correct: 0 },
                    { question: "What is SAP?", options: ["ERP software", "Accounting only", "Database", "None"], correct: 0 },
                    { question: "What is Oracle Financials?", options: ["Financial management software", "Database only", "Programming language", "None"], correct: 0 },
                    { question: "What is IFRS?", options: ["International Financial Reporting Standards", "Local standards", "Tax standards", "None"], correct: 0 },
                    { question: "What is GAAP?", options: ["Generally Accepted Accounting Principles", "Tax principles", "Audit principles", "None"], correct: 0 },
                    { question: "What is consolidated financial statement?", options: ["Combined statements of group companies", "Single company", "Branch only", "None"], correct: 0 },
                    { question: "What is goodwill?", options: ["Intangible asset", "Tangible asset", "Liability", "None"], correct: 0 },
                    { question: "What is amortization?", options: ["Spreading cost of intangible asset", "Depreciation", "Appreciation", "None"], correct: 0 },
                    { question: "What is provision?", options: ["Amount set aside for liability", "Asset", "Equity", "None"], correct: 0 },
                    { question: "What is reserve?", options: ["Retained earnings", "Liability", "Expense", "None"], correct: 0 },
                    { question: "What is capital expenditure?", options: ["Long term asset purchase", "Daily expenses", "Revenue expense", "None"], correct: 0 },
                    { question: "What is revenue expenditure?", options: ["Daily operational expenses", "Asset purchase", "Capital expense", "None"], correct: 0 },
                    { question: "What is accrual accounting?", options: ["Recording when earned/incurred", "Cash basis", "Hybrid", "None"], correct: 0 },
                    { question: "What is cash accounting?", options: ["Recording when cash received/paid", "Accrual basis", "Hybrid", "None"], correct: 0 },
                    { question: "What is materiality?", options: ["Significance of information", "Quantity", "Quality", "None"], correct: 0 },
                    { question: "What is consistency?", options: ["Using same methods", "Changing methods", "Random methods", "None"], correct: 0 },
                    { question: "What is going concern?", options: ["Business will continue", "Business will close", "Temporary", "None"], correct: 0 },
                    { question: "What is matching principle?", options: ["Match expenses with revenues", "Random matching", "No matching", "None"], correct: 0 },
                    { question: "What is conservatism?", options: ["Anticipate losses not gains", "Anticipate gains", "Neutral", "None"], correct: 0 },
                    { question: "What is full disclosure?", options: ["Reveal all material information", "Hide information", "Partial disclosure", "None"], correct: 0 }
                ]
            },
            "Data Analytics with AI": {
                1: [
                    { question: "What is data?", options: ["Raw facts", "Information", "Knowledge", "None"], correct: 0 },
                    { question: "What is analytics?", options: ["Analysis of data", "Collection", "Storage", "None"], correct: 0 },
                    { question: "What is AI?", options: ["Artificial Intelligence", "Automatic Intelligence", "Advanced Intelligence", "None"], correct: 0 },
                    { question: "What is machine learning?", options: ["AI subset", "Programming", "Database", "None"], correct: 0 },
                    { question: "What is Python?", options: ["Programming language", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is Excel?", options: ["Spreadsheet software", "Database", "Programming language", "None"], correct: 0 },
                    { question: "What is data visualization?", options: ["Graphical representation", "Text only", "Audio", "None"], correct: 0 },
                    { question: "What is a dataset?", options: ["Collection of data", "Single data point", "Database", "None"], correct: 0 },
                    { question: "What is a variable?", options: ["Data attribute", "Constant", "Function", "None"], correct: 0 },
                    { question: "What is statistics?", options: ["Study of data", "Programming", "Database", "None"], correct: 0 }
                ],
                2: [
                    { question: "What is pandas?", options: ["Python library for data", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is NumPy?", options: ["Numerical Python library", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is matplotlib?", options: ["Visualization library", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is mean?", options: ["Average", "Median", "Mode", "None"], correct: 0 },
                    { question: "What is median?", options: ["Middle value", "Average", "Mode", "None"], correct: 0 },
                    { question: "What is mode?", options: ["Most frequent value", "Average", "Median", "None"], correct: 0 },
                    { question: "What is standard deviation?", options: ["Measure of spread", "Average", "Median", "None"], correct: 0 },
                    { question: "What is correlation?", options: ["Relationship between variables", "Causation", "Independence", "None"], correct: 0 },
                    { question: "What is regression?", options: ["Predictive modeling", "Classification", "Clustering", "None"], correct: 0 },
                    { question: "What is classification?", options: ["Categorizing data", "Prediction", "Clustering", "None"], correct: 0 }
                ],
                3: [
                    { question: "What is deep learning?", options: ["Neural networks", "Machine learning", "AI", "None"], correct: 0 },
                    { question: "What is neural network?", options: ["Brain-inspired model", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is supervised learning?", options: ["Learning with labels", "Without labels", "Reinforcement", "None"], correct: 0 },
                    { question: "What is unsupervised learning?", options: ["Learning without labels", "With labels", "Reinforcement", "None"], correct: 0 },
                    { question: "What is clustering?", options: ["Grouping similar data", "Classification", "Regression", "None"], correct: 0 },
                    { question: "What is feature engineering?", options: ["Creating new features", "Data collection", "Visualization", "None"], correct: 0 },
                    { question: "What is overfitting?", options: ["Model too complex", "Too simple", "Perfect fit", "None"], correct: 0 },
                    { question: "What is underfitting?", options: ["Model too simple", "Too complex", "Perfect fit", "None"], correct: 0 },
                    { question: "What is cross-validation?", options: ["Model evaluation technique", "Training", "Testing", "None"], correct: 0 },
                    { question: "What is accuracy?", options: ["Correct predictions ratio", "Error rate", "Precision", "None"], correct: 0 }
                ],
                4: [
                    { question: "What is TensorFlow?", options: ["Deep learning framework", "Database", "Language", "None"], correct: 0 },
                    { question: "What is Keras?", options: ["High-level neural network API", "Database", "Language", "None"], correct: 0 },
                    { question: "What is scikit-learn?", options: ["Machine learning library", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is NLP?", options: ["Natural Language Processing", "Network Protocol", "Database", "None"], correct: 0 },
                    { question: "What is computer vision?", options: ["Image processing AI", "Text processing", "Audio processing", "None"], correct: 0 },
                    { question: "What is CNN?", options: ["Convolutional Neural Network", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is RNN?", options: ["Recurrent Neural Network", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is LSTM?", options: ["Long Short-Term Memory", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is GAN?", options: ["Generative Adversarial Network", "Database", "Framework", "None"], correct: 0 },
                    { question: "What is reinforcement learning?", options: ["Learning through rewards", "Supervised", "Unsupervised", "None"], correct: 0 },
                    { question: "What is transfer learning?", options: ["Using pre-trained models", "Training from scratch", "No training", "None"], correct: 0 },
                    { question: "What is ensemble learning?", options: ["Combining multiple models", "Single model", "No model", "None"], correct: 0 },
                    { question: "What is gradient descent?", options: ["Optimization algorithm", "Classification", "Clustering", "None"], correct: 0 },
                    { question: "What is backpropagation?", options: ["Training neural networks", "Forward pass", "Testing", "None"], correct: 0 },
                    { question: "What is activation function?", options: ["Non-linear transformation", "Linear only", "No transformation", "None"], correct: 0 },
                    { question: "What is dropout?", options: ["Regularization technique", "Overfitting", "Underfitting", "None"], correct: 0 },
                    { question: "What is batch normalization?", options: ["Normalizing layer inputs", "Data normalization", "No normalization", "None"], correct: 0 },
                    { question: "What is hyperparameter tuning?", options: ["Optimizing model parameters", "Training", "Testing", "None"], correct: 0 },
                    { question: "What is A/B testing?", options: ["Comparing two versions", "Single version", "No testing", "None"], correct: 0 },
                    { question: "What is big data?", options: ["Large volume of data", "Small data", "Medium data", "None"], correct: 0 }
                ]
            }
        };

        let currentQuestion = 0, answers = [], studentData = {}, timeLeft = 1800, timerInterval, startTime, selectedMonth = null, selectedTrade = null, currentQuestions = [];

        function loadMonthButtons() {
            const trade = document.getElementById('tradeSelect').value;
            const monthSelect = document.getElementById('monthSelect');
            
            if (!trade) {
                monthSelect.innerHTML = '<p style="color: #888; text-align: center;">Please select a trade first</p>';
                return;
            }
            
            const completedMonths = getCompletedMonths(trade);
            let html = '';
            
            for (let i = 1; i <= 4; i++) {
                const isCompleted = completedMonths.includes(i);
                const isLocked = i > 1 && !completedMonths.includes(i - 1);
                const questionCount = i === 4 ? 20 : 10;
                
                let classes = 'month-btn';
                if (isCompleted) classes += ' completed';
                if (isLocked) classes += ' locked';
                
                html += `<div class="${classes}" onclick="selectMonth(${i}, ${isLocked})">
                    <div style="font-size: 24px;">üìÖ</div>
                    <div>Month ${i}</div>
                    <small style="color: #888;">${questionCount} Questions</small>
                </div>`;
            }
            
            monthSelect.innerHTML = html;
        }

        function getCompletedMonths(trade) {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            const studentId = document.getElementById('studentId').value.trim();
            return results
                .filter(r => r.id === studentId && r.trade === trade)
                .map(r => r.month);
        }

        function selectMonth(month, isLocked) {
            if (isLocked) {
                document.getElementById('loginError').textContent = `Please complete Month ${month - 1} first!`;
                return;
            }
            selectedMonth = month;
            document.querySelectorAll('.month-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.month-btn').classList.add('selected');
            document.getElementById('loginError').textContent = '';
        }

        document.getElementById('tradeSelect').addEventListener('change', loadMonthButtons);
        document.getElementById('studentId').addEventListener('input', loadMonthButtons);

        function startTest() {
            const name = document.getElementById('studentName').value.trim();
            const id = document.getElementById('studentId').value.trim();
            const trade = document.getElementById('tradeSelect').value;
            const errorDiv = document.getElementById('loginError');
            
            if (!name || !id) { errorDiv.textContent = 'Please enter name and ID'; return; }
            if (!trade) { errorDiv.textContent = 'Please select your trade'; return; }
            if (!selectedMonth) { errorDiv.textContent = 'Please select a month'; return; }
            
            selectedTrade = trade;
            studentData = { name, id, trade, month: selectedMonth, startTime: new Date().toISOString() };
            currentQuestions = questionsByTradeAndMonth[trade][selectedMonth];
            startTime = Date.now();
            
            document.getElementById('displayName').textContent = name;
            document.getElementById('displayId').textContent = id;
            document.getElementById('tradeBadge').textContent = trade;
            document.getElementById('monthBadge').textContent = `Month ${selectedMonth}`;
            
            showScreen('testScreen');
            startTimer();
            loadQuestion();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
                document.getElementById('timer').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); endTest(); }
            }, 1000);
        }

        function loadQuestion() {
            const q = currentQuestions[currentQuestion];
            let html = `<div class="question"><h3>Question ${currentQuestion + 1} of ${currentQuestions.length}</h3><p style="font-size:18px;margin:20px 0">${q.question}</p><div>`;
            q.options.forEach((opt, i) => {
                const sel = answers[currentQuestion] === i;
                html += `<div class="option ${sel?'selected':''}" onclick="selectOption(${i})"><input type="radio" ${sel?'checked':''}> ${opt}</div>`;
            });
            html += '</div></div>';
            document.getElementById('questionContainer').innerHTML = html;
            document.getElementById('progress').style.width = ((currentQuestion + 1) / currentQuestions.length * 100) + '%';
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / ${currentQuestions.length}`;
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').textContent = currentQuestion === currentQuestions.length - 1 ? 'Finish' : 'Next ‚Üí';
        }

        function selectOption(i) { answers[currentQuestion] = i; loadQuestion(); }
        function previousQuestion() { if (currentQuestion > 0) { currentQuestion--; loadQuestion(); } }
        function nextQuestion() { if (currentQuestion < currentQuestions.length - 1) { currentQuestion++; loadQuestion(); } else endTest(); }

        function endTest() {
            clearInterval(timerInterval);
            let score = 0;
            answers.forEach((a, i) => { if (a === currentQuestions[i].correct) score++; });
            
            const result = { 
                ...studentData, 
                score, 
                total: currentQuestions.length, 
                endTime: new Date().toISOString() 
            };
            
            let results = JSON.parse(localStorage.getItem('testResults') || '[]');
            results.push(result);
            localStorage.setItem('testResults', JSON.stringify(results));
            
            document.getElementById('scoreDisplay').textContent = `${score}/${currentQuestions.length}`;
            document.getElementById('resultName').textContent = studentData.name;
            document.getElementById('resultId').textContent = studentData.id;
            document.getElementById('resultTrade').textContent = studentData.trade;
            document.getElementById('resultMonth').textContent = `Month ${studentData.month}`;
            showScreen('resultScreen');
        }

        function showAdminLogin() {
            const password = prompt('Enter Admin Password:');
            if (password === 'admin123') {
                viewAllResults();
            } else if (password !== null) {
                alert('Incorrect password!');
            }
        }

        function viewAllResults() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            let html = '<table><tr><th>Name</th><th>ID</th><th>Trade</th><th>Month</th><th>Score</th><th>Date</th></tr>';
            results.forEach(r => {
                html += `<tr><td>${r.name}</td><td>${r.id}</td><td>${r.trade}</td><td>Month ${r.month}</td><td>${r.score}/${r.total}</td><td>${new Date(r.endTime).toLocaleString()}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('resultsTable').innerHTML = html;
            showScreen('adminPanel');
        }

        function exportToCSV() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            let csv = 'Name,ID,Trade,Month,Score,Total,Date\n';
            results.forEach(r => csv += `${r.name},${r.id},${r.trade},Month ${r.month},${r.score},${r.total},"${new Date(r.endTime).toLocaleString()}"\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `All_Test_Results_${Date.now()}.csv`;
            a.click();
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL test results? This cannot be undone!')) {
                localStorage.removeItem('testResults');
                alert('All data cleared!');
                viewAllResults();
            }
        }

        function backToLogin() { showScreen('loginScreen'); loadMonthButtons(); }
        
        function resetTest() { 
            currentQuestion = 0; answers = []; studentData = {}; timeLeft = 1800; selectedMonth = null; selectedTrade = null; currentQuestions = [];
            showScreen('loginScreen'); 
            document.getElementById('studentName').value = ''; 
            document.getElementById('studentId').value = ''; 
            document.getElementById('tradeSelect').value = '';
            document.getElementById('loginError').textContent = '';
            loadMonthButtons();
        }
    </script>
</body>
</html>