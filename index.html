<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Test System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .screen { display: none; }
        .screen.active { display: block; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box, .result-box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); width: 100%; max-width: 500px; }
        h1 { color: white; text-align: center; margin-bottom: 30px; font-size: 2.5em; }
        h2 { color: #333; margin-bottom: 20px; text-align: center; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        input:focus { outline: none; border-color: #667eea; }
        button { width: 100%; padding: 15px; margin: 10px 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        button:hover { transform: translateY(-2px); }
        .error { color: #e74c3c; margin-top: 10px; text-align: center; }
        .test-header { background: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .timer { font-size: 24px; font-weight: bold; color: #e74c3c; padding: 10px 20px; background: #fff3cd; border-radius: 8px; }
        .test-container { max-width: 900px; margin: 30px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 10px; margin-bottom: 30px; }
        .progress { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s; }
        .option { padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; display: flex; align-items: center; }
        .option:hover { border-color: #667eea; background: #f8f9ff; }
        .option.selected { border-color: #667eea; background: #667eea; color: white; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; }
        .navigation button { width: auto; padding: 12px 30px; }
        .result-details { margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; }
        .result-details p { margin: 15px 0; font-size: 18px; }
        table { width: 100%; background: white; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    </style>
</head>
<body>
    <div id="loginScreen" class="screen active">
        <div class="container">
            <h1>üìö Online Test System</h1>
            <div class="login-box">
                <h2>Student Login</h2>
                <input type="text" id="studentName" placeholder="Enter Your Name">
                <input type="text" id="studentId" placeholder="Enter Your ID Number">
                <button onclick="startTest()">Start Test</button>
                <div id="loginError" class="error"></div>
            </div>
        </div>
    </div>

    <div id="testScreen" class="screen">
        <div class="test-header">
            <div><span id="displayName"></span> | <span id="displayId"></span></div>
            <div class="timer" id="timer">30:00</div>
        </div>
        <div class="test-container">
            <div class="progress-bar"><div class="progress" id="progress"></div></div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <button onclick="previousQuestion()" id="prevBtn">‚Üê Previous</button>
                <span id="questionCounter"></span>
                <button onclick="nextQuestion()" id="nextBtn">Next ‚Üí</button>
            </div>
            <button onclick="endTest()" style="background: #e74c3c; margin-top: 20px;">End Test</button>
        </div>
    </div>

    <div id="resultScreen" class="screen">
        <div class="container">
            <div class="result-box">
                <h1>üéâ Test Completed!</h1>
                <div class="result-details">
                    <p><strong>Name:</strong> <span id="resultName"></span></p>
                    <p><strong>ID:</strong> <span id="resultId"></span></p>
                    <p><strong>Score:</strong> <span id="resultScore"></span></p>
                    <p><strong>Percentage:</strong> <span id="resultPercentage"></span></p>
                    <p><strong>Time:</strong> <span id="timeTaken"></span></p>
                </div>
                <button onclick="downloadResults()">üì• Download Result</button>
                <button onclick="viewAllResults()">üìä View All Results</button>
                <button onclick="resetTest()">üîÑ New Test</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="screen">
        <div class="container">
            <h1 style="color: white;">üìä All Results</h1>
            <button onclick="backToResult()">‚Üê Back</button>
            <button onclick="exportToCSV()">üì• Export CSV</button>
            <div id="resultsTable"></div>
        </div>
    </div>

    <script>
        const questions = [
            { question: "What is the capital of Pakistan?", options: ["Karachi", "Lahore", "Islamabad", "Peshawar"], correct: 2 },
            { question: "Which language is known as 'language of the web'?", options: ["Python", "JavaScript", "Java", "C++"], correct: 1 },
            { question: "What does HTML stand for?", options: ["Hyper Text Markup Language", "High Tech Modern Language", "Home Tool Markup Language", "Hyperlinks Text Markup"], correct: 0 },
            { question: "Which planet is the Red Planet?", options: ["Venus", "Mars", "Jupiter", "Saturn"], correct: 1 },
            { question: "What is 15 √ó 8?", options: ["120", "125", "130", "115"], correct: 0 },
            { question: "Who wrote 'Romeo and Juliet'?", options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"], correct: 1 },
            { question: "Largest ocean on Earth?", options: ["Atlantic", "Indian", "Arctic", "Pacific"], correct: 3 },
            { question: "World War II ended in?", options: ["1943", "1944", "1945", "1946"], correct: 2 },
            { question: "Chemical symbol for Gold?", options: ["Go", "Gd", "Au", "Ag"], correct: 2 },
            { question: "How many continents?", options: ["5", "6", "7", "8"], correct: 2 }
        ];

        let currentQuestion = 0, answers = [], studentData = {}, timeLeft = 1800, timerInterval, startTime;

        function startTest() {
            const name = document.getElementById('studentName').value.trim();
            const id = document.getElementById('studentId').value.trim();
            if (!name || !id) { document.getElementById('loginError').textContent = 'Please enter both fields'; return; }
            studentData = { name, id, startTime: new Date().toISOString() };
            startTime = Date.now();
            document.getElementById('displayName').textContent = name;
            document.getElementById('displayId').textContent = id;
            showScreen('testScreen');
            startTimer();
            loadQuestion();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
                document.getElementById('timer').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); endTest(); }
            }, 1000);
        }

        function loadQuestion() {
            const q = questions[currentQuestion];
            let html = `<h3>Question ${currentQuestion + 1} of ${questions.length}</h3><p style="font-size:18px;margin:20px 0">${q.question}</p><div>`;
            q.options.forEach((opt, i) => {
                const sel = answers[currentQuestion] === i;
                html += `<div class="option ${sel?'selected':''}" onclick="selectOption(${i})"><input type="radio" ${sel?'checked':''}> ${opt}</div>`;
            });
            html += '</div>';
            document.getElementById('questionContainer').innerHTML = html;
            document.getElementById('progress').style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / ${questions.length}`;
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').textContent = currentQuestion === questions.length - 1 ? 'Finish' : 'Next ‚Üí';
        }

        function selectOption(i) { answers[currentQuestion] = i; loadQuestion(); }
        function previousQuestion() { if (currentQuestion > 0) { currentQuestion--; loadQuestion(); } }
        function nextQuestion() { if (currentQuestion < questions.length - 1) { currentQuestion++; loadQuestion(); } else endTest(); }

        function endTest() {
            clearInterval(timerInterval);
            const t = Math.floor((Date.now() - startTime) / 1000), m = Math.floor(t / 60), s = t % 60;
            let score = 0;
            answers.forEach((a, i) => { if (a === questions[i].correct) score++; });
            const pct = ((score / questions.length) * 100).toFixed(2);
            const result = { ...studentData, score, total: questions.length, percentage: pct, time: `${m}:${s.toString().padStart(2,'0')}`, endTime: new Date().toISOString() };
            let results = JSON.parse(localStorage.getItem('testResults') || '[]');
            results.push(result);
            localStorage.setItem('testResults', JSON.stringify(results));
            document.getElementById('resultName').textContent = studentData.name;
            document.getElementById('resultId').textContent = studentData.id;
            document.getElementById('resultScore').textContent = `${score} / ${questions.length}`;
            document.getElementById('resultPercentage').textContent = pct + '%';
            document.getElementById('timeTaken').textContent = `${m}:${s.toString().padStart(2,'0')}`;
            showScreen('resultScreen');
        }

        function downloadResults() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            const r = results[results.length - 1];
            const txt = `Student Result\n=============\nName: ${r.name}\nID: ${r.id}\nScore: ${r.score}/${r.total}\nPercentage: ${r.percentage}%\nTime: ${r.time}\nDate: ${new Date(r.endTime).toLocaleString()}`;
            const blob = new Blob([txt], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Result_${r.id}_${Date.now()}.txt`;
            a.click();
        }

        function viewAllResults() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            let html = '<table><tr><th>Name</th><th>ID</th><th>Score</th><th>%</th><th>Time</th><th>Date</th></tr>';
            results.forEach(r => {
                html += `<tr><td>${r.name}</td><td>${r.id}</td><td>${r.score}/${r.total}</td><td>${r.percentage}%</td><td>${r.time}</td><td>${new Date(r.endTime).toLocaleString()}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('resultsTable').innerHTML = html;
            showScreen('adminPanel');
        }

        function exportToCSV() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            let csv = 'Name,ID,Score,Total,Percentage,Time,Date\n';
            results.forEach(r => csv += `${r.name},${r.id},${r.score},${r.total},${r.percentage},${r.time},${new Date(r.endTime).toLocaleString()}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `All_Results_${Date.now()}.csv`;
            a.click();
        }

        function backToResult() { showScreen('resultScreen'); }
        function resetTest() { currentQuestion = 0; answers = []; studentData = {}; timeLeft = 1800; showScreen('loginScreen'); document.getElementById('studentName').value = ''; document.getElementById('studentId').value = ''; }
    </script>
</body>
</html>