<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MITI - Monthly Test System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); min-height: 100vh; color: #fff; }
        .screen { display: none; }
        .screen.active { display: block; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box, .result-box { background: #2d2d2d; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); width: 100%; max-width: 500px; border: 1px solid #444; }
        h1 { color: #fff; text-align: center; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        h2 { color: #fff; margin-bottom: 20px; text-align: center; }
        input, select { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #444; border-radius: 8px; font-size: 16px; background: #1a1a1a; color: #fff; }
        input:focus, select:focus { outline: none; border-color: #4CAF50; }
        select option { background: #1a1a1a; color: #fff; }
        button { width: 100%; padding: 15px; margin: 10px 0; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .error { color: #ff6b6b; margin-top: 10px; text-align: center; font-weight: bold; }
        .success { color: #4CAF50; margin-top: 10px; text-align: center; font-weight: bold; }
        .info { color: #2196F3; margin-top: 10px; text-align: center; font-size: 14px; }
        .test-header { background: #2d2d2d; padding: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.5); flex-wrap: wrap; gap: 10px; border-bottom: 2px solid #4CAF50; }
        .timer { font-size: 24px; font-weight: bold; color: #ff6b6b; padding: 10px 20px; background: #1a1a1a; border-radius: 8px; border: 2px solid #ff6b6b; }
        .month-badge { background: #4CAF50; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .trade-badge { background: #2196F3; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; }
        .test-container { max-width: 900px; margin: 30px auto; background: #2d2d2d; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid #444; }
        .progress-bar { width: 100%; height: 8px; background: #1a1a1a; border-radius: 10px; margin-bottom: 30px; border: 1px solid #444; }
        .progress { height: 100%; background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%); transition: width 0.3s; border-radius: 10px; }
        .option { padding: 15px; margin: 10px 0; border: 2px solid #444; border-radius: 8px; cursor: pointer; display: flex; align-items: center; transition: all 0.3s; background: #1a1a1a; text-align: left; }
        .option:hover { border-color: #4CAF50; background: #2d2d2d; }
        .option.selected { border-color: #4CAF50; background: #4CAF50; color: white; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; }
        .navigation button { width: auto; padding: 12px 30px; }
        .result-details { margin: 30px 0; padding: 20px; background: #1a1a1a; border-radius: 8px; border: 1px solid #444; }
        .result-details p { margin: 15px 0; font-size: 18px; color: #fff; }
        .result-details span { color: #4CAF50; font-weight: bold; }
        .score-display { font-size: 48px; text-align: center; color: #4CAF50; font-weight: bold; margin: 20px 0; }
        table { width: 100%; background: #2d2d2d; border-collapse: collapse; margin-top: 20px; border-radius: 8px; overflow: hidden; border: 1px solid #444; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; color: #fff; }
        th { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; font-weight: bold; }
        tr:hover { background: #1a1a1a; }
        .month-select { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .month-btn { padding: 20px; background: #1a1a1a; border: 2px solid #444; border-radius: 10px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s; color: #fff; position: relative; }
        .month-btn:hover:not(.completed) { border-color: #4CAF50; background: #2d2d2d; }
        .month-btn.selected { border-color: #4CAF50; background: #4CAF50; color: white; }
        .month-btn.completed { border-color: #4CAF50; }
        .month-btn.completed::after { content: '‚úÖ'; position: absolute; top: 10px; right: 10px; font-size: 20px; }
        .footer { position: fixed; bottom: 10px; right: 20px; color: #888; font-size: 14px; font-style: italic; }
        .question h3 { color: #fff; margin-bottom: 20px; text-align: left; }
        .question p { color: #ddd; text-align: left; }
        #questionCounter { color: #4CAF50; font-weight: bold; }
        .admin-btn { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%) !important; margin-top: 20px; }
        .time-slot-info { background: #1a1a1a; padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid #2196F3; }
        .time-slot-info h4 { color: #2196F3; margin-bottom: 10px; }
        .time-slot-info p { color: #fff; margin: 5px 0; }
        .admin-panel-box { background: #2d2d2d; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); border: 1px solid #444; margin: 20px 0; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-group button { flex: 1; min-width: 200px; }
        .question-editor { background: #1a1a1a; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #444; }
        .question-item { background: #2d2d2d; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; }
        .question-item input, .question-item textarea { margin: 5px 0; }
        textarea { width: 100%; padding: 10px; background: #1a1a1a; color: #fff; border: 2px solid #444; border-radius: 8px; font-family: inherit; resize: vertical; min-height: 60px; }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <h1>üìö MITI Test System</h1>
            <div class="login-box">
                <h2>Student Login</h2>
                <input type="text" id="studentName" placeholder="Enter Your Name">
                <input type="text" id="studentId" placeholder="Enter Your ID Number">
                
                <select id="tradeSelect">
                    <option value="">-- Select Your Trade --</option>
                    <option value="Computerized Accounting">Computerized Accounting</option>
                    <option value="Data Analytics with AI">Data Analytics with AI</option>
                </select>

                <select id="timingSelect" style="display:none;">
                    <option value="">-- Select Timing --</option>
                </select>
                
                <h3 style="margin-top: 20px; color: #fff; font-size: 16px;">Select Test Month:</h3>
                <div class="month-select" id="monthSelect"></div>
                
                <button onclick="startTest()">Start Test</button>
                <button onclick="showAdminLogin()" class="admin-btn">Admin Panel</button>
                <div id="loginError" class="error"></div>
                <div id="loginInfo" class="info"></div>
            </div>
        </div>
    </div>

    <!-- TEST SCREEN -->
    <div id="testScreen" class="screen">
        <div class="test-header">
            <div><span id="displayName"></span> | <span id="displayId"></span></div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <div class="trade-badge" id="tradeBadge">Trade</div>
                <div class="month-badge" id="monthBadge">Month 1</div>
            </div>
            <div class="timer" id="timer">30:00</div>
        </div>
        <div class="test-container">
            <div class="progress-bar"><div class="progress" id="progress"></div></div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <button onclick="previousQuestion()" id="prevBtn">‚Üê Previous</button>
                <span id="questionCounter"></span>
                <button onclick="nextQuestion()" id="nextBtn">Next ‚Üí</button>
            </div>
            <button onclick="endTest()" style="background: #ff6b6b; margin-top: 20px;">End Test</button>
        </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="resultScreen" class="screen">
        <div class="container">
            <div class="result-box">
                <h1>üéâ Test Completed!</h1>
                <div class="score-display" id="scoreDisplay">0/10</div>
                <div class="result-details">
                    <p><strong>Name:</strong> <span id="resultName"></span></p>
                    <p><strong>ID:</strong> <span id="resultId"></span></p>
                    <p><strong>Trade:</strong> <span id="resultTrade"></span></p>
                    <p><strong>Month:</strong> <span id="resultMonth"></span></p>
                </div>
                <div class="success" id="sheetSuccess" style="display:none;">‚úÖ Results saved to Google Sheets!</div>
                <button onclick="resetTest()">üîÑ Back to Login</button>
            </div>
        </div>
    </div>

    <!-- ADMIN LOGIN SCREEN -->
    <div id="adminLoginScreen" class="screen">
        <div class="container">
            <div class="login-box">
                <h2>üîê Admin Login</h2>
                <input type="text" id="adminUsername" placeholder="Username">
                <input type="password" id="adminPassword" placeholder="Password">
                <button onclick="adminLogin()">Login</button>
                <button onclick="backToLogin()" style="background: #666;">‚Üê Back</button>
                <div id="adminLoginError" class="error"></div>
            </div>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="screen">
        <div class="container" style="max-width: 1200px;">
            <h1>üìä Admin Panel</h1>
            <div class="admin-panel-box">
                <div class="btn-group">
                    <button onclick="viewAllResults()">üìã View All Results</button>
                    <button onclick="showQuestionEditor()">‚úèÔ∏è Edit Questions</button>
                    <button onclick="exportToCSV()">üì• Export to CSV</button>
                    <button onclick="openGoogleSheet()">üìä Open Google Sheet</button>
                    <button onclick="clearAllData()" style="background: #ff6b6b;">üóëÔ∏è Clear All Data</button>
                    <button onclick="adminLogout()" style="background: #666;">üö™ Logout</button>
                </div>
            </div>
            <div id="adminContent"></div>
        </div>
    </div>

    <div class="footer">Prepared by Sir Faris</div>

    <script>
        // CONFIGURATION
        const CONFIG = {
            SHEET_ID: '1cOiIjbKBvLrsnvs5qXOh1DsM2X7ypaGA-GHjwamae1g',
            ADMIN_USERNAME: 'Faris',
            ADMIN_PASSWORD: 'Mititest',
            TIME_SLOTS: {
                'Computerized Accounting': [
                    { label: 'Morning (9:00 AM - 11:00 AM)', value: '09:00-11:00' },
                    { label: 'Evening (5:00 PM - 7:00 PM)', value: '17:00-19:00' }
                ],
                'Data Analytics with AI': [
                    { label: 'Morning (11:00 AM - 1:00 PM)', value: '11:00-13:00' },
                    { label: 'Evening (7:00 PM - 9:00 PM)', value: '19:00-21:00' }
                ]
            }
        };

        // QUESTIONS DATABASE
        const questionsByTradeAndMonth = {
            "Computerized Accounting": {
                1: [
                    { question: "What is accounting?", options: ["Recording transactions", "Selling products", "Marketing", "None"], correct: 0 },
                    { question: "What is a debit?", options: ["Increase in asset", "Decrease in asset", "Increase in liability", "None"], correct: 0 },
                    { question: "What is a credit?", options: ["Decrease in asset", "Increase in asset", "Decrease in liability", "None"], correct: 0 },
                    { question: "What is a journal?", options: ["Book of original entry", "Final accounts", "Balance sheet", "None"], correct: 0 },
                    { question: "What is a ledger?", options: ["Book of final entry", "Book of original entry", "Cash book", "None"], correct: 0 },
                    { question: "What is double entry?", options: ["Two entries for each transaction", "One entry", "Three entries", "None"], correct: 0 },
                    { question: "What is trial balance?", options: ["List of all balances", "Final accounts", "Journal", "None"], correct: 0 },
                    { question: "What is balance sheet?", options: ["Statement of financial position", "Income statement", "Cash flow", "None"], correct: 0 },
                    { question: "What is income statement?", options: ["Profit and loss", "Balance sheet", "Cash flow", "None"], correct: 0 },
                    { question: "What is cash flow?", options: ["Movement of cash", "Profit", "Loss", "None"], correct: 0 }
                ],
                2: [
                    { question: "What is QuickBooks?", options: ["Accounting software", "Database", "Programming language", "None"], correct: 0 },
                    { question: "What is Tally?", options: ["Accounting software", "Spreadsheet", "Word processor", "None"], correct: 0 },
                    { question: "What is depreciation?", options: ["Decrease in asset value", "Increase in asset", "Liability", "None"], correct: 0 },
                    { question: "What is GST?", options: ["Goods and Services Tax", "Income tax", "Sales tax", "None"], correct: 0 },
                    { question: "What is invoice?", options: ["Bill for goods/services", "Receipt", "Voucher", "None"], correct: 0 },
                    { question: "What is voucher?", options: ["Document for transaction", "Invoice", "Receipt", "None"], correct: 0 },
                    { question: "What is bank reconciliation?", options: ["Matching bank and book balances", "Closing accounts", "Opening accounts", "None"], correct: 0 },
                    { question: "What is petty cash?", options: ["Small cash expenses", "Large expenses", "Bank balance", "None"], correct: 0 },
                    { question: "What is accounts payable?", options: ["Money owed to suppliers", "Money owed by customers", "Assets", "None"], correct: 0 },
                    { question: "What is accounts receivable?", options: ["Money owed by customers", "Money owed to suppliers", "Liabilities", "None"], correct: 0 }
                ],
                3: [
                    { question: "What is financial statement?", options: ["Summary of financial activities", "Journal", "Ledger", "None"], correct: 0 },
                    { question: "What is audit?", options: ["Examination of accounts", "Recording", "Posting", "None"], correct: 0 },
                    { question: "What is budget?", options: ["Financial plan", "Actual expenses", "Invoice", "None"], correct: 0 },
                    { question: "What is variance?", options: ["Difference between budget and actual", "Budget only", "Actual only", "None"], correct: 0 },
                    { question: "What is cost accounting?", options: ["Recording and analyzing costs", "Financial accounting", "Tax accounting", "None"], correct: 0 },
                    { question: "What is management accounting?", options: ["Internal reporting", "External reporting", "Tax reporting", "None"], correct: 0 },
                    { question: "What is ratio analysis?", options: ["Analyzing financial ratios", "Recording transactions", "Posting", "None"], correct: 0 },
                    { question: "What is working capital?", options: ["Current assets minus current liabilities", "Fixed assets", "Long term debt", "None"], correct: 0 },
                    { question: "What is equity?", options: ["Owner's capital", "Liabilities", "Assets", "None"], correct: 0 },
                    { question: "What is liability?", options: ["Obligations to pay", "Assets", "Equity", "None"], correct: 0 }
                ],
                4: [
                    { question: "What is ERP?", options: ["Enterprise Resource Planning", "Accounting software", "Database", "None"], correct: 0 },
                    { question: "What is SAP?", options: ["ERP software", "Accounting only", "Database", "None"], correct: 0 },
                    { question: "What is Oracle Financials?", options: ["Financial management software", "Database only", "Programming language", "None"], correct: 0 },
                    { question: "What is IFRS?", options: ["International Financial Reporting Standards", "Local standards", "Tax standards", "None"], correct: 0 },
                    { question: "What is GAAP?", options: ["Generally Accepted Accounting Principles", "Tax principles", "Audit principles", "None"], correct: 0 },
                    { question: "What is consolidated financial statement?", options: ["Combined statements of group companies", "Single company", "Branch only", "None"], correct: 0 },
                    { question: "What is goodwill?", options: ["Intangible asset", "Tangible asset", "Liability", "None"], correct: 0 },
                    { question: "What is amortization?", options: ["Spreading cost of intangible asset", "Depreciation", "Appreciation", "None"], correct: 0 },
                    { question: "What is provision?", options: ["Amount set aside for liability", "Asset", "Equity", "None"], correct: 0 },
                    { question: "What is reserve?", options: ["Retained earnings", "Liability", "Expense", "None"], correct: 0 },
                    { question: "What is capital expenditure?", options: ["Long term asset purchase", "Daily expenses", "Revenue expense", "None"], correct: 0 },
                    { question: "What is revenue expenditure?", options: ["Daily operational expenses", "Asset purchase", "Capital expense", "None"], correct: 0 },
                    { question: "What is accrual accounting?", options: ["Recording when earned/incurred", "Cash basis", "Hybrid", "None"], correct: 0 },
                    { question: "What is cash accounting?", options: ["Recording when cash received/paid", "Accrual basis", "Hybrid", "None"], correct: 0 },
                    { question: "What is materiality?", options: ["Significance of information", "Quantity", "Quality", "None"], correct: 0 },
                    { question: "What is consistency?", options: ["Using same methods", "Changing methods", "Random methods", "None"], correct: 0 },
                    { question: "What is going concern?", options: ["Business will continue", "Business will close", "Temporary", "None"], correct: 0 },
                    { question: "What is matching principle?", options: ["Match expenses with revenues", "Random matching", "No matching", "None"], correct: 0 },
                    { question: "What is conservatism?", options: ["Anticipate losses not gains", "Anticipate gains", "Neutral", "None"], correct: 0 },
                    { question: "What is full disclosure?", options: ["Reveal all material information", "Hide information", "Partial disclosure", "None"], correct: 0 }
                ]
            },
            "Data Analytics with AI": {
                1: [
                    { question: "What is the correct syntax of IF() function?", options: ["=IF(logical test, value_if_true, value_if_false)", "=IF (logical test, TRUE([value_if_true]), FALSE([value_if_false]))", "None of these", "All of these"], correct: 0 },
                    { question: "Which of the following formula enter is not correctly?", options: ["=B7*C7", "-1- + 50", "10+50", "=10+B7"], correct: 1 },
                    { question: "Pivot table use for?", options: ["Analysis Data", "Find Data", "None of These", "Remove Data"], correct: 0 },
                    { question: "How many types of option use in the timeline?", options: ["Years", "Days", "Quater", "All of Above"], correct: 3 },
                    { question: "What is the purpose of $ sign in formula?", options: ["For currency Symbol", "For Fix Error", "For Fixing cell Address", "All of these"], correct: 2 },
                    { question: "Except for the ...... function, a formula with a logical function shows the word \"TRUE\" or \"FALSE\" as a result", options: ["End", "OR", "Not", "IF"], correct: 3 },
                    { question: "Which function is used to trap and handle errors?", options: ["IFERROR", "ERROR", "IFNA", "None of these"], correct: 0 },
                    { question: "What is shortcut key of sum?", options: ["Alt+ Enter", "Alt + =", "Ctrl + +", "Ctrl + ="], correct: 1 },
                    { question: "If we select 5 rows and 5 columns how many cells will be selected", options: ["25", "10", "15", "None of these"], correct: 0 },
                    { question: "Which symbol must be with all formulas?", options: ["=", "@", "%", "#"], correct: 0 }
                ],
                2: [
                    { question: "What is a Database in the context described?", options: ["A single table of data", "A collection of related tables", "A programming language", "A type of chart"], correct: 1 },
                    { question: "Which SQL command is primarily used to retrieve data from a database?", options: ["INSERT", "UPDATE", "DELETE", "SELECT"], correct: 3 },
                    { question: "Which SQL clause is used to filter records based on a specified condition?", options: ["LIMIT", "ORDER BY", "WHERE", "GROUP BY"], correct: 2 },
                    { question: "What is a JOIN used for in SQL?", options: ["To combine rows from two or more tables based on a related column", "To insert new rows into a table", "To delete rows from a table", "To modify the structure of a table"], correct: 0 },
                    { question: "Which command is used to add new rows of data into a table?", options: ["SELECT", "UPDATE", "INSERT", "ALTER"], correct: 2 },
                    { question: "COUNT, SUM, and AVG are examples of what type of functions in SQL?", options: ["Logical Functions", "Lookup Functions", "String Functions", "Aggregate Functions"], correct: 3 },
                    { question: "Which SQL clause is used to sort the result set in ascending or descending order?", options: ["WHERE", "LIMIT", "GROUP BY", "ORDER BY"], correct: 3 },
                    { question: "What is a Key in the context of databases and tables?", options: ["A clause used in SELECT statements", "A constraint used to establish relationships or ensure data integrity", "A type of SQL command", "An aggregate function"], correct: 1 },
                    { question: "Which command is used to modify existing records in a table?", options: ["INSERT", "UPDATE", "DELETE", "ALTER"], correct: 1 },
                    { question: "What does the ALTER command in SQL allow you to do?", options: ["Select specific columns from a table", "Modify the structure of an existing table", "Delete all records from a table", "Combine results from multiple SELECT statements"], correct: 1 }
                ],
                3: [
                    { question: "In Python, what are int, float, str, and bool examples of?", options: ["Operators", "Variables", "Datatypes", "Functions"], correct: 2 },
                    { question: "Which programming construct in Python is used to execute a block of code multiple times?", options: ["Conditional Statement", "Function", "Loop", "Module"], correct: 2 },
                    { question: "Lists, Tuples, Dictionaries, and Sets are examples of what in Python?", options: ["Control Flow Structures", "Built-in Functions", "Data Structures", "Operators"], correct: 2 },
                    { question: "What is a Lambda Function in Python?", options: ["A function used for looping", "A small, anonymous function", "A function for file handling", "A recursive function"], correct: 1 },
                    { question: "Which Python libraries are specifically mentioned for data manipulation and working with arrays?", options: ["Matplotlib and Seaborn", "SQLite and REST APIs", "Pandas and NumPy", "JSON and XML"], correct: 2 },
                    { question: "In the context of Python, what are Classes and Objects related to?", options: ["Data Visualization", "File Handling", "Database Operations", "Object-Oriented Programming (OOP) Basics"], correct: 3 },
                    { question: "Which module type is mentioned as containing functions and definitions already available in Python?", options: ["Creation of Modules", "Project Random Module", "In-built Modules", "Lambda Functions"], correct: 2 },
                    { question: "What operations are listed as part of SQL CRUD Operations in Python?", options: ["Charting and Plotting", "Create, Read, Update, Delete", "Sorting and Filtering", "Merging and Appending"], correct: 1 },
                    { question: "Which concept is mentioned as being used with For Loops in Python?", options: ["Recursive Statement", "Conditional Statements", "Lambda Function", "File Handling"], correct: 1 },
                    { question: "What is the term for accessing a specific part of a list or tuple in Python?", options: ["Iteration", "Function Calling", "Slicing", "Comprehension"], correct: 2 }
                ],
                4: [
                    { question: "To apply formatting to cells based on their values meeting a specific condition, which tool would you use?", options: ["Basic Formatting Tools", "Conditional Formatting Basics", "Data Validation", "Text to Columns"], correct: 1 },
                    { question: "Which Excel operation is used to arrange data in ascending or descending order?", options: ["Filtering Data", "Removing Duplicates", "Sorting Data", "Text to Columns"], correct: 2 },
                    { question: "Which function is used in Excel to find the smallest value in a range of cells?", options: ["MIN", "AVERAGE", "SUM", "MAX"], correct: 0 },
                    { question: "Which Excel tool allows you to summarize and analyze large amounts of data in a table format?", options: ["Pivot Tables", "Basic Charts", "Excel Tables", "Data Validation"], correct: 0 },
                    { question: "VLOOKUP and INDEX-MATCH are examples of what type of functions in Excel?", options: ["Basic Math Functions", "Lookup Functions", "Logical Functions", "Aggregate Functions"], correct: 1 },
                    { question: "What is a Database in the context described?", options: ["A single table of data", "A collection of related tables", "A programming language", "A type of chart"], correct: 1 },
                    { question: "In the context of Python, what are Classes and Objects related to?", options: ["Data Visualization", "File Handling", "Database Operations", "Object-Oriented Programming (OOP) Basics"], correct: 3 },
                    { question: "Which SQL clause is used to sort the result set in ascending or descending order?", options: ["WHERE", "LIMIT", "GROUP BY", "ORDER BY"], correct: 3 },
                    { question: "What is a Key in the context of databases and tables?", options: ["A clause used in SELECT statements", "A constraint used to establish relationships or ensure data integrity", "A type of SQL command", "An aggregate function"], correct: 1 },
                    { question: "What does the ALTER command in SQL allow you to do?", options: ["Select specific columns from a table", "Modify the structure of an existing table", "Delete all records from a table", "Combine results from multiple SELECT statements"], correct: 1 },
                    { question: "Which module type is mentioned as containing functions and definitions already available in Python?", options: ["Creation of Modules", "Project Random Module", "In-built Modules", "Lambda Functions"], correct: 2 },
                    { question: "Which concept is mentioned as being used with For Loops in Python?", options: ["Recursive Statement", "Conditional Statements", "Lambda Function", "File Handling"], correct: 1 },
                    { question: "What does DAX stand for in the context of Power BI?", options: ["Data Analysis Exchange", "Database Access XML", "Data Analysis Expressions", "Digital Analytics Extensions"], correct: 2 },
                    { question: "What is the purpose of Calculated Columns and Measures in Power BI, as described?", options: ["To connect to different data sources", "To perform data transformations", "To define calculations on data", "To format visualizations"], correct: 2 },
                    { question: "Which action is specifically listed as a basic transformation in Power BI?", options: ["Creating Measures", "Publishing Reports", "Dealing with Unwanted Columns and Null Values", "Designing for Phone Viewers"], correct: 2 },
                    { question: "What concept in Power BI relates to defining how tables are connected and filtered?", options: ["Data Visualization", "Data Model and Importance of Data Modeling", "DAX Functions", "Basic Transformations"], correct: 1 },
                    { question: "Cardinality and Cross-Filter Direction are concepts related to what in Power BI?", options: ["DAX Syntax", "Managing Data Relationships", "Visualization Charts", "Text Tools"], correct: 1 },
                    { question: "Which Power BI feature allows users to filter data interactively on a report page?", options: ["Matrix Visuals", "Slicers", "KPI Visuals", "Tool Tips"], correct: 1 },
                    { question: "What type of visual is listed for displaying a single aggregate value clearly?", options: ["TreeMap", "Map Visuals", "Number Cards and Text Cards", "Stacked Bar Chart"], correct: 2 },
                    { question: "What is the final step mentioned after creating a report in Power BI?", options: ["Creating DAX Functions", "Publishing Reports to Power BI Services", "Adding Conditional Columns", "Managing Data Relationships"], correct: 1 }
                ]
            }
        };

        // STATE
        let currentQuestion = 0, answers = [], studentData = {}, timeLeft = 1800, timerInterval, selectedMonth = null, selectedTrade = null, selectedTiming = null, currentQuestions = [];

        // UTILITY FUNCTIONS
        function getCompletedMonths(trade, studentId) {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            return results
                .filter(r => r.id === studentId && r.trade === trade)
                .map(r => r.month);
        }

        function loadTimingOptions() {
            const trade = document.getElementById('tradeSelect').value;
            const timingSelect = document.getElementById('timingSelect');
            
            if (!trade) {
                timingSelect.style.display = 'none';
                return;
            }
            
            const slots = CONFIG.TIME_SLOTS[trade];
            if (slots) {
                let html = '<option value="">-- Select Timing --</option>';
                slots.forEach(slot => {
                    html += `<option value="${slot.value}">${slot.label}</option>`;
                });
                timingSelect.innerHTML = html;
                timingSelect.style.display = 'block';
            }
        }

        function loadMonthButtons() {
            const trade = document.getElementById('tradeSelect').value;
            const studentId = document.getElementById('studentId').value.trim();
            const monthSelect = document.getElementById('monthSelect');
            
            if (!trade) {
                monthSelect.innerHTML = '<p style="color: #888; text-align: center;">Please select a trade first</p>';
                return;
            }
            
            if (!studentId) {
                monthSelect.innerHTML = '<p style="color: #888; text-align: center;">Please enter your ID first</p>';
                return;
            }
            
            const completedMonths = getCompletedMonths(trade, studentId);
            let html = '';
            
            for (let i = 1; i <= 4; i++) {
                const isCompleted = completedMonths.includes(i);
                const questionCount = i === 4 ? 20 : 10;
                
                let classes = 'month-btn';
                if (isCompleted) classes += ' completed';
                
                html += `<div class="${classes}" onclick="selectMonth(${i}, ${isCompleted})">
                    <div style="font-size: 24px;">üìÖ</div>
                    <div>Month ${i}</div>
                    <small style="color: #888;">${questionCount} Questions</small>
                </div>`;
            }
            
            monthSelect.innerHTML = html;
        }

        function selectMonth(month, isCompleted) {
            if (isCompleted) {
                document.getElementById('loginError').textContent = `You have already completed Month ${month} test! You cannot re-attempt.`;
                return;
            }
            
            selectedMonth = month;
            document.querySelectorAll('.month-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.month-btn').classList.add('selected');
            document.getElementById('loginError').textContent = '';
        }

        document.getElementById('tradeSelect').addEventListener('change', function() {
            loadTimingOptions();
            loadMonthButtons();
        });
        document.getElementById('studentId').addEventListener('input', loadMonthButtons);

        function startTest() {
            const name = document.getElementById('studentName').value.trim();
            const id = document.getElementById('studentId').value.trim();
            const trade = document.getElementById('tradeSelect').value;
            const timing = document.getElementById('timingSelect').value;
            const errorDiv = document.getElementById('loginError');
            
            errorDiv.textContent = '';
            
            if (!name || !id) { errorDiv.textContent = 'Please enter name and ID'; return; }
            if (!trade) { errorDiv.textContent = 'Please select your trade'; return; }
            if (!timing) { errorDiv.textContent = 'Please select timing'; return; }
            if (!selectedMonth) { errorDiv.textContent = 'Please select a month'; return; }
            
            const completedMonths = getCompletedMonths(trade, id);
            if (completedMonths.includes(selectedMonth)) {
                errorDiv.textContent = `You have already completed Month ${selectedMonth} test! You cannot re-attempt.`;
                return;
            }
            
            selectedTrade = trade;
            selectedTiming = timing;
            studentData = { name, id, trade, timing, month: selectedMonth, startTime: new Date().toISOString() };
            currentQuestions = questionsByTradeAndMonth[trade][selectedMonth];
            
            if (!currentQuestions || currentQuestions.length === 0) {
                errorDiv.textContent = `Month ${selectedMonth} questions are not available yet. Please contact Sir Faris.`;
                return;
            }
            
            document.getElementById('displayName').textContent = name;
            document.getElementById('displayId').textContent = id;
            document.getElementById('tradeBadge').textContent = trade;
            document.getElementById('monthBadge').textContent = `Month ${selectedMonth}`;
            
            showScreen('testScreen');
            startTimer();
            loadQuestion();
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
                document.getElementById('timer').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); endTest(); }
            }, 1000);
        }

        function loadQuestion() {
            const q = currentQuestions[currentQuestion];
            let html = `<div class="question"><h3>Question ${currentQuestion + 1} of ${currentQuestions.length}</h3><p style="font-size:18px;margin:20px 0">${q.question}</p><div>`;
            q.options.forEach((opt, i) => {
                const sel = answers[currentQuestion] === i;
                html += `<div class="option ${sel?'selected':''}" onclick="selectOption(${i})"><input type="radio" ${sel?'checked':''}> ${opt}</div>`;
            });
            html += '</div></div>';
            document.getElementById('questionContainer').innerHTML = html;
            document.getElementById('progress').style.width = ((currentQuestion + 1) / currentQuestions.length * 100) + '%';
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} / ${currentQuestions.length}`;
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').textContent = currentQuestion === currentQuestions.length - 1 ? 'Finish' : 'Next ‚Üí';
        }

        function selectOption(i) { answers[currentQuestion] = i; loadQuestion(); }
        function previousQuestion() { if (currentQuestion > 0) { currentQuestion--; loadQuestion(); } }
        function nextQuestion() { if (currentQuestion < currentQuestions.length - 1) { currentQuestion++; loadQuestion(); } else endTest(); }

        async function endTest() {
            clearInterval(timerInterval);
            let score = 0;
            answers.forEach((a, i) => { if (a === currentQuestions[i].correct) score++; });
            
            const result = { 
                ...studentData, 
                score, 
                total: currentQuestions.length, 
                endTime: new Date().toISOString() 
            };
            
            let results = JSON.parse(localStorage.getItem('testResults') || '[]');
            results.push(result);
            localStorage.setItem('testResults', JSON.stringify(results));
            
            document.getElementById('scoreDisplay').textContent = `${score}/${currentQuestions.length}`;
            document.getElementById('resultName').textContent = studentData.name;
            document.getElementById('resultId').textContent = studentData.id;
            document.getElementById('resultTrade').textContent = studentData.trade;
            document.getElementById('resultMonth').textContent = `Month ${studentData.month}`;
            document.getElementById('sheetSuccess').style.display = 'block';
            showScreen('resultScreen');
        }

        function showAdminLogin() {
            showScreen('adminLoginScreen');
        }

        function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === CONFIG.ADMIN_USERNAME && password === CONFIG.ADMIN_PASSWORD) {
                showScreen('adminPanel');
                viewAllResults();
            } else {
                document.getElementById('adminLoginError').textContent = 'Invalid username or password!';
            }
        }

        function adminLogout() {
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            backToLogin();
        }

        function viewAllResults() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            let html = '<h2>üìã All Test Results</h2><table><tr><th>Name</th><th>ID</th><th>Trade</th><th>Month</th><th>Score</th><th>Date</th></tr>';
            results.forEach(r => {
                html += `<tr><td>${r.name}</td><td>${r.id}</td><td>${r.trade}</td><td>Month ${r.month}</td><td>${r.score}/${r.total}</td><td>${new Date(r.endTime).toLocaleString()}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('adminContent').innerHTML = html;
        }

        function showQuestionEditor() {
            let html = '<h2>‚úèÔ∏è Question Editor</h2>';
            html += '<select id="editorTrade" onchange="loadEditorMonths()"><option value="">Select Trade</option><option value="Computerized Accounting">Computerized Accounting</option><option value="Data Analytics with AI">Data Analytics with AI</option></select>';
            html += '<select id="editorMonth" style="display:none;" onchange="loadQuestionsForEdit()"><option value="">Select Month</option></select>';
            html += '<div id="questionEditorContent"></div>';
            document.getElementById('adminContent').innerHTML = html;
        }

        function loadEditorMonths() {
            const trade = document.getElementById('editorTrade').value;
            const monthSelect = document.getElementById('editorMonth');
            if (!trade) {
                monthSelect.style.display = 'none';
                return;
            }
            let html = '<option value="">Select Month</option>';
            for (let i = 1; i <= 4; i++) {
                html += `<option value="${i}">Month ${i}</option>`;
            }
            monthSelect.innerHTML = html;
            monthSelect.style.display = 'block';
        }

        function loadQuestionsForEdit() {
            const trade = document.getElementById('editorTrade').value;
            const month = parseInt(document.getElementById('editorMonth').value);
            if (!trade || !month) return;
            
            const questions = questionsByTradeAndMonth[trade][month];
            let html = '<div class="question-editor">';
            html += `<h3>Editing: ${trade} - Month ${month}</h3>`;
            
            questions.forEach((q, idx) => {
                html += `<div class="question-item">
                    <h4>Question ${idx + 1}</h4>
                    <textarea id="q_${idx}_text" placeholder="Question">${q.question}</textarea>
                    <input type="text" id="q_${idx}_opt0" placeholder="Option A" value="${q.options[0]}">
                    <input type="text" id="q_${idx}_opt1" placeholder="Option B" value="${q.options[1]}">
                    <input type="text" id="q_${idx}_opt2" placeholder="Option C" value="${q.options[2]}">
                    <input type="text" id="q_${idx}_opt3" placeholder="Option D" value="${q.options[3]}">
                    <select id="q_${idx}_correct">
                        <option value="0" ${q.correct===0?'selected':''}>A is correct</option>
                        <option value="1" ${q.correct===1?'selected':''}>B is correct</option>
                        <option value="2" ${q.correct===2?'selected':''}>C is correct</option>
                        <option value="3" ${q.correct===3?'selected':''}>D is correct</option>
                    </select>
                </div>`;
            });
            
            html += `<button onclick="saveQuestions('${trade}', ${month})">üíæ Save All Changes</button>`;
            html += '</div>';
            document.getElementById('questionEditorContent').innerHTML = html;
        }

        function saveQuestions(trade, month) {
            const questions = questionsByTradeAndMonth[trade][month];
            questions.forEach((q, idx) => {
                q.question = document.getElementById(`q_${idx}_text`).value;
                q.options[0] = document.getElementById(`q_${idx}_opt0`).value;
                q.options[1] = document.getElementById(`q_${idx}_opt1`).value;
                q.options[2] = document.getElementById(`q_${idx}_opt2`).value;
                q.options[3] = document.getElementById(`q_${idx}_opt3`).value;
                q.correct = parseInt(document.getElementById(`q_${idx}_correct`).value);
            });
            alert('‚úÖ Questions saved successfully! Note: Changes are temporary. To make permanent, download the HTML file and re-upload to GitHub.');
        }

        function exportToCSV() {
            const results = JSON.parse(localStorage.getItem('testResults') || '[]');
            let csv = 'Name,ID,Trade,Month,Score,Total,Date\n';
            results.forEach(r => csv += `${r.name},${r.id},${r.trade},Month ${r.month},${r.score},${r.total},"${new Date(r.endTime).toLocaleString()}"\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `MITI_Test_Results_${Date.now()}.csv`;
            a.click();
        }

        function openGoogleSheet() {
            window.open(`https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/edit`, '_blank');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL test results? This cannot be undone!')) {
                localStorage.removeItem('testResults');
                alert('All data cleared!');
                viewAllResults();
            }
        }

        function backToLogin() { 
            showScreen('loginScreen'); 
            loadMonthButtons(); 
        }
        
        function resetTest() { 
            currentQuestion = 0; answers = []; studentData = {}; timeLeft = 1800; selectedMonth = null; selectedTrade = null; selectedTiming = null; currentQuestions = [];
            showScreen('loginScreen'); 
            document.getElementById('studentName').value = ''; 
            document.getElementById('studentId').value = ''; 
            document.getElementById('tradeSelect').value = '';
            document.getElementById('timingSelect').value = '';
            document.getElementById('timingSelect').style.display = 'none';
            document.getElementById('loginError').textContent = '';
            loadMonthButtons();
        }
    </script>
</body>
</html>